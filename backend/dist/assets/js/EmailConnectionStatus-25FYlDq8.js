import{ai as G,j as e,P as C,w as n,aM as d,S as h,aY as H,a6 as p,b2 as V,U as E,Y,a1 as J,b1 as K,D as I,L as z,E as k}from"./mui-core-C3ffLUwq.js";import{a as m}from"./react-vendor-Unh15Wwx.js";import{a as y}from"./utils-DW_MHI2K.js";import{V as Q,p as X,c6 as D,c7 as B,ad as Z,c8 as _,a5 as ee,v as te,M as re,G as ae}from"./mui-icons-BgFiLgsU.js";import{u as oe}from"./EmailManager-B39ecuy_.js";import{m as P}from"./animations-Dee_auZ3.js";import"./index-D20Pene_.js";import"./Footer-Q6Op8PTj.js";import"./ColorModeIconDropdown-BtgzeTFD.js";import"./mui-B3oaDO5C.js";import"./treeView-uPFLF-bj.js";import"./data-grid-o9Hnqe8f.js";const v="https://replai.tech";function ge({refreshTrigger:L}){const r=G(),{enqueueSnackbar:s}=oe(),[x,j]=m.useState([]),[O,f]=m.useState(!0),[w,b]=m.useState(null),[A,M]=m.useState(null),[i,$]=m.useState(null);m.useEffect(()=>{(async()=>{f(!0),b(null);const a=localStorage.getItem("token");if(!a){f(!1),b("Authentication required");return}try{const o=await y.get(`${v}/api/emails/connected`,{headers:{Authorization:`Bearer ${a}`}});j(o.data),f(!1)}catch(o){console.error("Error fetching connected emails:",o),b("Failed to load connected email accounts"),f(!1)}})()},[L]);const R=(t,a)=>{M(t.currentTarget),$(a)},g=()=>{M(null),$(null)},T=async t=>{g();const a=localStorage.getItem("token");if(!a){s("Authentication required",{variant:"error"});return}try{s("Syncing email account...",{variant:"info"}),await y.post(`${v}/api/emails/${t}/sync`,{},{headers:{Authorization:`Bearer ${a}`}}),s("Email account synced successfully",{variant:"success"})}catch(o){console.error("Error syncing email:",o),s("Failed to sync email account",{variant:"error"})}},W=async(t,a)=>{g();const o=localStorage.getItem("token");if(!o){s("Authentication required",{variant:"error"});return}const u=a==="active"?"paused":"active";try{await y.patch(`${v}/api/emails/${t}/status`,{status:u},{headers:{Authorization:`Bearer ${o}`}}),j(c=>c.map(l=>l.id===t?{...l,status:u}:l)),s(`Email account ${u==="active"?"activated":"paused"}`,{variant:"success"})}catch(c){console.error("Error toggling email status:",c),s("Failed to update email account status",{variant:"error"})}},q=async t=>{g();const a=localStorage.getItem("token");if(!a){s("Authentication required",{variant:"error"});return}try{await y.delete(`${v}/api/emails/${t}`,{headers:{Authorization:`Bearer ${a}`}}),j(o=>o.filter(u=>u.id!==t)),s("Email account disconnected successfully",{variant:"success"})}catch(o){console.error("Error disconnecting email:",o),s("Failed to disconnect email account",{variant:"error"})}},F=t=>{switch(t){case"google":return e.jsx(ae,{sx:{color:"#DB4437"}});case"microsoft":return e.jsx(re,{sx:{color:"#0078D4"}});case"custom":default:return e.jsx(te,{sx:{color:"#673AB7"}})}},N=t=>{const a=new Date(t),u=new Date().getTime()-a.getTime(),c=Math.floor(u/6e4);if(c<1)return"Just now";if(c<60)return`${c} min${c>1?"s":""} ago`;const l=Math.floor(c/60);if(l<24)return`${l} hour${l>1?"s":""} ago`;const S=Math.floor(l/24);return S<7?`${S} day${S>1?"s":""} ago`:a.toLocaleDateString()},U={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{delay:.3,duration:.5}}};return O?e.jsxs(C,{elevation:0,sx:{p:3,borderRadius:3,border:"1px solid",borderColor:n(r.palette.divider,.1)},children:[e.jsx(d,{sx:{mb:2},children:e.jsx(h,{variant:"text",width:200,height:24})}),[1,2].map(t=>e.jsxs(d,{sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(h,{variant:"circular",width:40,height:40,sx:{mr:2}}),e.jsxs(d,{sx:{flex:1},children:[e.jsx(h,{variant:"text",width:"60%"}),e.jsx(h,{variant:"text",width:"40%"})]}),e.jsx(h,{variant:"circular",width:24,height:24})]},t))]}):w?e.jsx(H,{severity:"error",sx:{borderRadius:3,mb:3},children:w}):x.length===0?e.jsxs(C,{component:P.div,variants:U,initial:"hidden",animate:"visible",elevation:0,sx:{p:4,borderRadius:3,border:"1px solid",borderColor:n(r.palette.divider,.1),textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:200},children:[e.jsx(d,{sx:{mb:2,p:2,borderRadius:"50%",backgroundColor:n(r.palette.primary.main,.1),display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Q,{sx:{fontSize:40,color:r.palette.primary.main,opacity:.8}})}),e.jsx(p,{variant:"h6",gutterBottom:!0,children:"No Email Accounts Connected"}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{maxWidth:400,mx:"auto"},children:"Connect your email accounts above to start automating responses and analyzing your email performance."})]}):e.jsxs(C,{elevation:0,sx:{borderRadius:3,border:"1px solid",borderColor:n(r.palette.divider,.1),overflow:"hidden"},children:[x.map((t,a)=>e.jsxs(m.Fragment,{children:[e.jsxs(d,{component:P.div,initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.1,duration:.3},sx:{p:3,display:"flex",alignItems:"center",gap:2,backgroundColor:t.status==="error"?n(r.palette.error.main,.05):"transparent"},children:[e.jsx(V,{src:t.avatarUrl,alt:t.displayName||t.email,sx:{width:48,height:48,bgcolor:n(r.palette.primary.main,.1)},children:F(t.provider)}),e.jsxs(d,{sx:{flex:1},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:.5},children:[e.jsx(p,{variant:"subtitle1",sx:{fontWeight:500},children:t.displayName||t.email.split("@")[0]}),t.status==="active"&&e.jsx(E,{size:"small",icon:e.jsx(X,{sx:{fontSize:"0.75rem !important"}}),label:"Active",sx:{ml:1.5,height:20,fontSize:"0.7rem",fontWeight:500,backgroundColor:n(r.palette.success.main,.1),color:r.palette.success.main,"& .MuiChip-icon":{color:r.palette.success.main}}}),t.status==="paused"&&e.jsx(E,{size:"small",icon:e.jsx(D,{sx:{fontSize:"0.75rem !important"}}),label:"Paused",sx:{ml:1.5,height:20,fontSize:"0.7rem",fontWeight:500,backgroundColor:n(r.palette.warning.main,.1),color:r.palette.warning.main,"& .MuiChip-icon":{color:r.palette.warning.main}}}),t.status==="error"&&e.jsx(E,{size:"small",label:"Error",sx:{ml:1.5,height:20,fontSize:"0.7rem",fontWeight:500,backgroundColor:n(r.palette.error.main,.1),color:r.palette.error.main}})]}),e.jsx(p,{variant:"body2",color:"text.secondary",children:t.email}),t.status==="error"&&t.error&&e.jsxs(p,{variant:"caption",sx:{color:r.palette.error.main,display:"block",mt:.5},children:["Error: ",t.error]}),e.jsxs(d,{sx:{display:"flex",alignItems:"center",mt:.5,color:r.palette.text.secondary,fontSize:"0.75rem"},children:[e.jsx(B,{sx:{fontSize:"0.875rem",mr:.5,opacity:.7}}),"Last synced ",N(t.lastSynced)]})]}),e.jsx(Y,{size:"small",onClick:o=>R(o,t.id),sx:{color:r.palette.text.secondary,"&:hover":{backgroundColor:n(r.palette.action.active,.05)}},children:e.jsx(Z,{fontSize:"small"})})]}),a<x.length-1&&e.jsx(J,{sx:{mx:3,borderColor:n(r.palette.divider,.08)}})]},t.id)),e.jsxs(K,{anchorEl:A,open:!!A,onClose:g,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},PaperProps:{elevation:3,sx:{borderRadius:2,minWidth:180,mt:.5,"& .MuiMenuItem-root":{py:1.2,px:2}}},children:[e.jsxs(I,{onClick:()=>i&&T(i),children:[e.jsx(z,{children:e.jsx(B,{fontSize:"small"})}),e.jsx(k,{children:"Sync Now"})]}),i&&e.jsxs(I,{onClick:()=>{const t=x.find(a=>a.id===i);t&&W(i,t.status)},children:[e.jsx(z,{children:x.find(t=>t.id===i)?.status==="active"?e.jsx(D,{fontSize:"small"}):e.jsx(_,{fontSize:"small"})}),e.jsx(k,{children:x.find(t=>t.id===i)?.status==="active"?"Pause Account":"Activate Account"})]}),e.jsxs(I,{onClick:()=>i&&q(i),children:[e.jsx(z,{children:e.jsx(ee,{fontSize:"small",sx:{color:r.palette.error.main}})}),e.jsx(k,{sx:{color:r.palette.error.main},children:"Disconnect"})]})]})]})}export{ge as default};
