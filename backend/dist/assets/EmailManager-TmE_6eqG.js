import{al as te,j as e,av as de,aw as pe,ao as l,T as ue,w as a,X as xe,as as g,Z as z,P as I,S as A,ap as d,a3 as me,aN as he,U as R,W as H,Y as P,aM as ge,D as O,L as W,E as N,a1 as ye,aO as fe,aE as be,an as je}from"./mui-core-DOYD86GU.js";import{a as u}from"./react-vendor-DaePdQuf.js";import{Z as _,J as L,_ as q,$ as ve,y as X,a0 as K,a1 as Q,a2 as ee,a3 as Ce,a4 as Se,a5 as ke,G as we,a6 as Ie,a7 as Ee,a8 as ze,a9 as Ae,aa as Re}from"./mui-icons-Dt2vrCwP.js";import{S as $e,A as Me,H as De,D as Te}from"./Footer-Bup7o7W3.js";import{a as j}from"./utils-DW_MHI2K.js";import{u as Be,A as Oe}from"./index-DpSzz6g3.js";import{m as f,A as We}from"./animations-Dbd-n05v.js";import{t as Ne,d as Le,a as Fe,c as He}from"./treeView-D9GhbMOU.js";import"./ColorModeIconDropdown-9PVwswVS.js";import"./data-grid-C3egMnXH.js";const v="https://replai.tech",Pe={hidden:{opacity:0,y:10},visible:E=>({opacity:1,y:0,transition:{delay:E*.1,duration:.3,ease:"easeOut"}}),exit:{opacity:0,y:10}};function Ve(){const{user:E}=Be(),r=te(),[m,h]=u.useState([]),[b,y]=u.useState(!0),[C,V]=u.useState(null),[$,re]=u.useState(""),[s,M]=u.useState(null),[G,U]=u.useState(null),[D,x]=u.useState({open:!1,message:"",severity:"success"}),T=async()=>{const t=localStorage.getItem("token");if(!t){console.error("No token found");return}y(!0),V(null);try{let n=(await j.get(`${v}/api/emails/connected`,{headers:{Authorization:`Bearer ${t}`}})).data;n&&typeof n=="object"&&"connectedEmails"in n&&(n=n.connectedEmails);const c=n.map((o,p)=>({id:p,email:o.email||"",provider:o.provider||"google",status:o.syncEnabled===!1?"paused":o.status||"active",lastSync:J(o.lastSync),type:o.type||"personal",autoReplyEnabled:o.autoReplyEnabled!==!1,mode:o.mode||"normal",syncEnabled:o.syncEnabled!==!1,picture:o.picture||null,name:o.name||""}));h(c),y(!1)}catch(i){console.error("Error fetching connected emails:",i),V("Error fetching connected emails"),y(!1)}},J=t=>{if(!t)return"Never";try{const i=new Date(t),c=new Date().getTime()-i.getTime(),o=Math.round(c/6e4);if(o<1)return"Just now";if(o<60)return`${o} minute${o===1?"":"s"} ago`;const p=Math.floor(o/60);if(p<24)return`${p} hour${p===1?"":"s"} ago`;const w=Math.floor(p/24);return w<7?`${w} day${w===1?"":"s"} ago`:i.toLocaleDateString()}catch{return"Invalid date"}},ne=async t=>{const i=localStorage.getItem("token");if(!i){console.error("No token found");return}try{await j.post(`${v}/api/emails/disconnect`,{email:t},{headers:{Authorization:`Bearer ${i}`}}),h(m.filter(n=>n.email!==t)),x({open:!0,message:`Email ${t} disconnected successfully`,severity:"success"}),S()}catch(n){console.error("Error disconnecting email:",n),x({open:!0,message:"Failed to disconnect email",severity:"error"})}},oe=async t=>{if(!t)return;const i=localStorage.getItem("token");if(!i){console.error("No token found");return}const n=!t.autoReplyEnabled;try{await j.patch(`${v}/api/emails/connected/auto-reply/${t.email}`,{enabled:n},{headers:{Authorization:`Bearer ${i}`}});const c=m.map(o=>o.id===t.id?{...o,autoReplyEnabled:n}:o);h(c),s&&s.id===t.id&&M({...s,autoReplyEnabled:n}),x({open:!0,message:`${n?"Draft":"Auto reply"} mode activated`,severity:"success"}),S()}catch(c){console.error("Error toggling auto-reply:",c),x({open:!0,message:"Failed to update auto-reply settings",severity:"error"})}},se=async t=>{if(!t)return;const i=localStorage.getItem("token");if(!i){console.error("No token found");return}const n=!t.syncEnabled;try{await j.patch(`${v}/api/emails/connected/sync/${t.email}`,{enabled:n},{headers:{Authorization:`Bearer ${i}`}});const c=m.map(o=>o.id===t.id?{...o,syncEnabled:n,status:n?"active":"paused"}:o);h(c),s&&s.id===t.id&&M({...s,syncEnabled:n,status:n?"active":"paused"}),x({open:!0,message:`Sync ${n?"resumed":"paused"}`,severity:"success"}),S()}catch(c){console.error("Error toggling sync:",c),x({open:!0,message:"Failed to update sync settings",severity:"error"})}},ae=async t=>{if(!t)return;const i=m.map(c=>c.id===t.id?{...c,status:"syncing",lastSync:"syncing..."}:c);h(i);const n=localStorage.getItem("token");if(!n){console.error("No token found");return}try{const o=(await j.patch(`${v}/api/emails/connected/sync/${t.email}`,{enabled:!0},{headers:{Authorization:`Bearer ${n}`}})).data,p=o.lastSync?J(o.lastSync):"Just now",w=m.map(B=>B.id===t.id?{...B,status:"active",lastSync:p}:B);h(w),x({open:!0,message:"Account refreshed successfully",severity:"success"})}catch(c){console.error("Error refreshing account:",c);const o=m.map(p=>p.id===t.id?{...p,status:"error"}:p);h(o),x({open:!0,message:"Failed to refresh account",severity:"error"})}S()},ie=(t,i)=>{M(i),U(t.currentTarget)},S=()=>{U(null)};u.useEffect(()=>{T()},[]);const k=m.filter(t=>t.email.toLowerCase().includes($.toLowerCase())),le=t=>{switch(t.toLowerCase()){case"google":case"gmail":return e.jsx(we,{sx:{fontSize:18}});default:return e.jsx(X,{sx:{fontSize:18}})}},ce=t=>{switch(t){case"active":return e.jsx(Ee,{sx:{color:r.palette.success.main,fontSize:16}});case"error":return e.jsx(Ie,{sx:{color:r.palette.error.main,fontSize:16}});case"syncing":return e.jsx(ee,{sx:{color:r.palette.info.main,fontSize:16,animation:"spin 1.5s linear infinite"}});default:return null}},Y=t=>{switch(t){case"active":return r.palette.success.main;case"error":return r.palette.error.main;case"syncing":return r.palette.info.main;default:return r.palette.text.secondary}},[Je,Ye]=u.useState(0),Z=async()=>{y(!0);const t=localStorage.getItem("token");if(!t){console.error("No token found"),y(!1);return}try{const n=(await j.get(`${v}/api/emails/auth/google`,{headers:{Authorization:`Bearer ${t}`}})).data.authUrl;window.location.href=n}catch(i){console.error("Error creating bot:",i),y(!1)}};return e.jsx(de,{elevation:0,sx:{borderRadius:3,border:"1px solid",borderColor:r.palette.divider,overflow:"visible"},children:e.jsxs(pe,{sx:{p:{xs:2,sm:3}},children:[e.jsxs(l,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"},mb:3,gap:2},children:[e.jsx(ue,{placeholder:"Search email accounts",variant:"outlined",size:"small",value:$,onChange:t=>re(t.target.value),InputProps:{startAdornment:e.jsx(xe,{position:"start",children:e.jsx(_,{fontSize:"small",color:"action"})}),sx:{borderRadius:2,backgroundColor:a(r.palette.background.paper,.5),"& .MuiOutlinedInput-notchedOutline":{borderColor:a(r.palette.divider,.6)},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:r.palette.primary.main}}},sx:{width:{xs:"100%",sm:300},"& .MuiInputBase-root":{borderRadius:2}}}),e.jsxs(g,{direction:"row",spacing:1.5,children:[e.jsx(z,{variant:"outlined",size:"small",startIcon:e.jsx(L,{}),onClick:()=>T(),sx:{borderRadius:2,borderColor:r.palette.divider,color:r.palette.text.secondary,"&:hover":{borderColor:r.palette.primary.main,backgroundColor:a(r.palette.primary.main,.05)}},children:"Refresh All"}),e.jsx(z,{variant:"contained",size:"small",startIcon:e.jsx(q,{}),color:"primary",disableElevation:!0,onClick:Z,sx:{borderRadius:2,fontWeight:600,boxShadow:r.palette.mode==="dark"?`0 2px 8px ${a(r.palette.common.black,.3)}`:`0 2px 8px ${a(r.palette.primary.main,.2)}`},children:"Add Account"})]})]}),b?e.jsx(l,{sx:{mt:3},children:[1,2,3].map((t,i)=>e.jsx(I,{elevation:0,sx:{p:2,mb:2,borderRadius:2,border:"1px solid",borderColor:r.palette.divider},children:e.jsxs(g,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(g,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(A,{variant:"circular",width:40,height:40}),e.jsxs(l,{children:[e.jsx(A,{variant:"text",width:180,height:24}),e.jsx(A,{variant:"text",width:120,height:20})]})]}),e.jsx(A,{variant:"rounded",width:100,height:36})]})},i))}):C?e.jsxs(I,{elevation:0,sx:{p:3,borderRadius:2,textAlign:"center",border:"1px solid",borderColor:a(r.palette.error.main,.2),bgcolor:a(r.palette.error.main,.05)},children:[e.jsx(ve,{color:"error",sx:{fontSize:40,opacity:.8,mb:1}}),e.jsx(d,{color:"error.main",variant:"h6",gutterBottom:!0,children:"Error Loading Accounts"}),e.jsx(d,{color:"text.secondary",sx:{mb:2},children:C||"Failed to load your connected email accounts"}),e.jsx(z,{variant:"outlined",color:"primary",startIcon:e.jsx(L,{}),onClick:T,sx:{borderRadius:2},children:"Try Again"})]}):k.length===0?$?e.jsxs(l,{textAlign:"center",py:4,children:[e.jsx(_,{sx:{fontSize:48,color:"text.secondary",opacity:.5}}),e.jsx(d,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"No matching accounts"}),e.jsx(d,{color:"text.secondary",children:"No email accounts match your search query"})]}):e.jsxs(I,{elevation:0,sx:{p:4,borderRadius:2,textAlign:"center",border:"1px dashed",borderColor:r.palette.divider,bgcolor:a(r.palette.background.paper,.5)},children:[e.jsx(l,{sx:{width:60,height:60,borderRadius:"50%",backgroundColor:a(r.palette.primary.main,.1),display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:e.jsx(X,{sx:{fontSize:30,color:r.palette.primary.main}})}),e.jsx(d,{variant:"h6",gutterBottom:!0,children:"No Email Accounts Connected"}),e.jsx(d,{color:"text.secondary",sx:{maxWidth:400,mx:"auto",mb:3},children:"Connect your email accounts to start automating responses and get analytics"}),e.jsx(z,{variant:"contained",startIcon:e.jsx(q,{}),sx:{borderRadius:2,px:3,py:1},onClick:Z,children:"Connect Your First Account"})]}):e.jsx(l,{children:k.map((t,i)=>e.jsx(l,{component:f.div,custom:i,initial:"hidden",animate:"visible",variants:Pe,sx:{mb:2},children:e.jsx(I,{elevation:0,sx:{p:2,borderRadius:2,border:"1px solid",borderColor:a(r.palette.divider,.8),transition:"all 0.2s ease","&:hover":{borderColor:r.palette.primary.main,boxShadow:`0 4px 12px ${a(r.palette.primary.main,.1)}`,transform:"translateY(-2px)"}},children:e.jsxs(g,{direction:{xs:"column",sm:"row"},spacing:{xs:2,sm:0},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},children:[e.jsxs(g,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(me,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:t.status&&e.jsx(l,{sx:{width:14,height:14,borderRadius:"50%",backgroundColor:Y(t.status),border:`2px solid ${r.palette.background.paper}`}}),children:e.jsx(he,{sx:{width:44,height:44,backgroundColor:a(r.palette.primary.main,.1),color:r.palette.primary.main,border:"1px solid",borderColor:a(r.palette.primary.main,.2)},children:le(t.provider)})}),e.jsxs(l,{children:[e.jsx(d,{variant:"subtitle1",sx:{fontWeight:600,lineHeight:1.2},children:t.email}),e.jsxs(g,{direction:"row",spacing:1,alignItems:"center",sx:{mt:.5},children:[t.type&&e.jsx(R,{label:t.type,size:"small",sx:{height:20,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",backgroundColor:a(r.palette.action.selected,.1),"& .MuiChip-label":{px:1}}}),e.jsxs(d,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.5,color:Y(t.status)},children:[ce(t.status),t.status==="active"?"Active":t.status==="error"?"Connection error":t.status==="syncing"?"Syncing...":""]}),e.jsxs(d,{variant:"caption",color:"text.secondary",sx:{display:{xs:"none",sm:"block"}},children:["Last synced: ",t.lastSync||"Never"]})]}),e.jsx(R,{size:"small",variant:"outlined",color:"primary",label:t.autoReplyEnabled?" Draft mode enabled":" Auto reply mode enabled",icon:t.autoReplyEnabled?e.jsx(K,{fontSize:"small"}):e.jsx(Q,{fontSize:"small"}),sx:{mt:.5,"& .MuiChip-icon":{mr:0},px:1}})]})]}),e.jsxs(g,{direction:"row",spacing:1,sx:{alignSelf:{xs:"flex-end",sm:"center"},mt:{xs:1,sm:0}},children:[e.jsx(H,{title:"Sync account",children:e.jsx(P,{size:"small",onClick:()=>ae(t),sx:{color:r.palette.text.secondary,backgroundColor:a(r.palette.action.hover,.1),"&:hover":{backgroundColor:a(r.palette.primary.main,.1),color:r.palette.primary.main}},children:e.jsx(ee,{fontSize:"small"})})}),e.jsxs(l,{children:[e.jsx(H,{title:"More options",children:e.jsx(P,{size:"small",onClick:n=>ie(n,t),sx:{color:r.palette.text.secondary,backgroundColor:a(r.palette.action.hover,.1),"&:hover":{backgroundColor:a(r.palette.primary.main,.1),color:r.palette.primary.main}},children:e.jsx(Ce,{fontSize:"small"})})}),e.jsxs(ge,{anchorEl:G,open:!!G,onClose:S,elevation:2,sx:{mt:1,"& .MuiPaper-root":{borderRadius:2,boxShadow:r.palette.mode==="dark"?"0 4px 20px rgba(0,0,0,0.4)":"0 4px 20px rgba(0,0,0,0.1)"}},onClick:n=>n.stopPropagation(),children:[e.jsxs(O,{onClick:()=>s&&oe(s),disabled:!s,children:[e.jsx(W,{children:s!=null&&s.autoReplyEnabled?e.jsx(K,{fontSize:"small"}):e.jsx(Q,{fontSize:"small"})}),e.jsxs(N,{children:[s!=null&&s.autoReplyEnabled?"Auto Reply":"Draft"," ","Mode"]})]}),e.jsxs(O,{onClick:()=>s&&se(s),disabled:!s,children:[e.jsx(W,{children:(s==null?void 0:s.syncEnabled)===!1?e.jsx(L,{fontSize:"small"}):e.jsx(Se,{fontSize:"small"})}),e.jsxs(N,{children:[(s==null?void 0:s.syncEnabled)===!1?"Resume":"Pause"," ","Sync"]})]}),e.jsx(ye,{}),e.jsxs(O,{onClick:()=>s&&ne(s.email),disabled:!s,sx:{color:r.palette.error.main},children:[e.jsx(W,{children:e.jsx(ke,{fontSize:"small",sx:{color:r.palette.error.main}})}),e.jsx(N,{children:"Disconnect"})]})]})]})]})]})})},t.id))}),k.length>0&&!b&&!C&&e.jsx(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3,pt:2,borderTop:"1px solid",borderColor:r.palette.divider,flexDirection:{xs:"column",sm:"row"},gap:1},children:e.jsxs(d,{variant:"body2",color:"text.secondary",children:[k.length," active account",k.length>1?"s":""]})}),e.jsx(fe,{open:D.open,autoHideDuration:6e3,onClose:()=>x(t=>({...t,open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(be,{onClose:()=>x(t=>({...t,open:!1})),severity:D.severity,sx:{width:"100%"},children:D.message})})]})})}const Ge={...He,...Fe,...Le,...Ne},Ue={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,when:"beforeChildren"}}},F={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:300,damping:30}}};function ot(E){const r=te(),[m,h]=u.useState(!1),[b,y]=u.useState(0);return e.jsxs(Oe,{...E,themeComponents:Ge,children:[e.jsx(je,{enableColorScheme:!0}),e.jsxs(l,{sx:{display:"flex"},children:[e.jsx($e,{}),e.jsx(Me,{}),e.jsxs(l,{component:"main",sx:C=>({flexGrow:1,backgroundColor:a(C.palette.background.default,1),overflow:"auto",minHeight:"100vh"}),children:[e.jsx(g,{spacing:2,sx:{alignItems:"center",mx:{xs:2,sm:3},pb:2,mt:{xs:8,md:0}},children:e.jsx(De,{})}),e.jsxs(l,{component:f.div,variants:Ue,initial:"hidden",animate:"visible",sx:{px:{xs:2,sm:3},pb:5},children:[e.jsx(l,{component:f.div,variants:F,sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:3,gap:2},children:e.jsxs(l,{children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(l,{component:f.div,whileHover:{rotate:[0,-10,10,-10,0]},transition:{duration:.5},sx:{mr:1,display:"flex",alignItems:"center",justifyContent:"center",p:1,borderRadius:"50%",background:"linear-gradient(90deg,rgb(0, 98, 255),rgb(43, 156, 255))"},children:e.jsx(ze,{sx:{color:"white",fontSize:32,opacity:.8}})}),e.jsx(d,{variant:"h3",component:"h1",sx:{color:"transparent",fontWeight:700,background:"linear-gradient(90deg,rgb(0, 98, 255),rgb(43, 156, 255))",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",display:"inline-block",mr:3,zIndex:1,opacity:.7},children:"Email Manager"}),e.jsx(H,{title:"Connect your email accounts to automate responses",placement:"right",children:e.jsx(P,{size:"small",sx:{ml:1},children:e.jsx(Ae,{fontSize:"small"})})})]}),e.jsx(d,{variant:"body1",color:"text.secondary",sx:{maxWidth:600},children:"Connect and manage your email accounts for automated responses and analytics."})]})}),e.jsx(l,{component:f.div,variants:F,sx:{mb:4},children:e.jsxs(I,{elevation:0,sx:{p:3,borderRadius:3,border:"1px solid",borderColor:a(r.palette.info.main,.2),background:r.palette.mode==="dark"?a(r.palette.info.main,.2):a(r.palette.info.main,.1),display:"flex",alignItems:"center",gap:2,flexDirection:{xs:"column",sm:"row"},textAlign:{xs:"center",sm:"left"}},children:[e.jsx(l,{sx:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",width:40,height:40,backgroundColor:r.palette.mode==="dark"?a(r.palette.info.main,.2):a(r.palette.info.main,.1)},children:e.jsx(Re,{sx:{color:r.palette.info.main}})}),e.jsxs(l,{sx:{flex:1},children:[e.jsx(d,{variant:"subtitle1",sx:{color:r.palette.info.main,fontWeight:600,mb:.5},children:"Why connect your email?"}),e.jsx(d,{variant:"body2",children:"Connected email accounts enable automatic responses, email analysis, and help you save time managing your inbox. We only use read-only access and never store your passwords."})]}),e.jsx(R,{label:"Secure OAuth2",size:"small",color:"secondary",sx:{fontWeight:500,backgroundColor:r.palette.mode==="dark"?a(r.palette.info.main,.5):a(r.palette.info.main,.9),borderRadius:1.5}})]})}),e.jsxs(l,{component:f.div,variants:F,children:[e.jsxs(d,{variant:"h6",sx:{mb:2.5,ml:2,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:["Connected Accounts",e.jsx(R,{label:"Refreshing...",size:"small",color:"default",variant:"outlined",sx:{height:24,display:b>0?"inline-flex":"none","& .MuiChip-label":{px:1},borderColor:a(r.palette.action.active,.2)}})]}),e.jsx(We,{mode:"wait",children:e.jsx(f.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},children:e.jsx(Ve,{},b)},b)})]})]}),e.jsx(Te,{})]})]})]})}export{ot as default};
